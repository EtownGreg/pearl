# vim: ft=yaml

language: bash

sudo: required

jobs:
  include:
    - os: linux
      env:
        - PYTHON_VERSION="3.5"
        - TRAVIS_BASH_VERSION="4.1" TRAVIS_ZSH_VERSION="5.0.0" TRAVIS_FISH_VERSION="2.2.0" TRAVIS_GIT_VERSION="1.8.5"
        - secure: "QhVCwaBpCebV4ZEgvqrymqTboawuGF6+VrbA6hytxP6j6cN6gGKYZt0CLcemUylGQFD4wnKtVHnB0CH9XEQdCORroRXsl1ovpGYvOkM0jGRXZ/veS//kKfuF+BE6o0Mk7O0XseQjDeAAwjC336luxpjEjSf/oIMa3p9NBvjQe+Tsqzal2jYrWsAOG8DkO2hVzXU2VeuxnANt7oxfn8kHsRJsxLREZV+0SEsQXoHv14s6Id2ZkyK2NKCzhLKfzkU/oD0hZvuaKLDMdVCa7V6/xNhcCvtKC/V63M8OxJ/q5JZj7+XUjSBui0/Nsmy5a5IW4KJByNbItD2PmukeFu3hq6vRK9xjulTaQiz68Iq1arnQXG5eWdYkriE+ixkBx+kFTtMoag3Qz9JRNlmxoFWG4HP38aSPlXEdz30ZmBhyjfJ7FsIPGaCFp66e2meKuMP4oPQkIrnlX5dca6kvM5xdVO4jU14q5sQxZgaa8r8Z1gXhJbka6F1gVlOKMn3w9ISTNWYUTuVnBtV5mXefQFm5etjYu57ovNh3jVPRv0QqP2Vba0cZxn2IkOQc0HBSNB5tRbIMFJNSugKi4lBA2hwNTge4DNAMHppEhi6s2Gin/p4Es5BK3JiwtzggPgs+2J0Xc1GLXKlr3QHrczeC3Ubvfx9O6iEpWCdzzjqVAzywJ5w="
    - os: linux
      env:
        - PYTHON_VERSION="3.6"
        - TRAVIS_BASH_VERSION="4.1" TRAVIS_ZSH_VERSION="5.0.0" TRAVIS_FISH_VERSION="2.2.0" TRAVIS_GIT_VERSION="1.8.5"
        - secure: "QhVCwaBpCebV4ZEgvqrymqTboawuGF6+VrbA6hytxP6j6cN6gGKYZt0CLcemUylGQFD4wnKtVHnB0CH9XEQdCORroRXsl1ovpGYvOkM0jGRXZ/veS//kKfuF+BE6o0Mk7O0XseQjDeAAwjC336luxpjEjSf/oIMa3p9NBvjQe+Tsqzal2jYrWsAOG8DkO2hVzXU2VeuxnANt7oxfn8kHsRJsxLREZV+0SEsQXoHv14s6Id2ZkyK2NKCzhLKfzkU/oD0hZvuaKLDMdVCa7V6/xNhcCvtKC/V63M8OxJ/q5JZj7+XUjSBui0/Nsmy5a5IW4KJByNbItD2PmukeFu3hq6vRK9xjulTaQiz68Iq1arnQXG5eWdYkriE+ixkBx+kFTtMoag3Qz9JRNlmxoFWG4HP38aSPlXEdz30ZmBhyjfJ7FsIPGaCFp66e2meKuMP4oPQkIrnlX5dca6kvM5xdVO4jU14q5sQxZgaa8r8Z1gXhJbka6F1gVlOKMn3w9ISTNWYUTuVnBtV5mXefQFm5etjYu57ovNh3jVPRv0QqP2Vba0cZxn2IkOQc0HBSNB5tRbIMFJNSugKi4lBA2hwNTge4DNAMHppEhi6s2Gin/p4Es5BK3JiwtzggPgs+2J0Xc1GLXKlr3QHrczeC3Ubvfx9O6iEpWCdzzjqVAzywJ5w="
    - os: linux
      env:
        - PYTHON_VERSION="3.7"
        - TRAVIS_BASH_VERSION="4.1" TRAVIS_ZSH_VERSION="5.0.0" TRAVIS_FISH_VERSION="2.2.0" TRAVIS_GIT_VERSION="1.8.5"
        - secure: "QhVCwaBpCebV4ZEgvqrymqTboawuGF6+VrbA6hytxP6j6cN6gGKYZt0CLcemUylGQFD4wnKtVHnB0CH9XEQdCORroRXsl1ovpGYvOkM0jGRXZ/veS//kKfuF+BE6o0Mk7O0XseQjDeAAwjC336luxpjEjSf/oIMa3p9NBvjQe+Tsqzal2jYrWsAOG8DkO2hVzXU2VeuxnANt7oxfn8kHsRJsxLREZV+0SEsQXoHv14s6Id2ZkyK2NKCzhLKfzkU/oD0hZvuaKLDMdVCa7V6/xNhcCvtKC/V63M8OxJ/q5JZj7+XUjSBui0/Nsmy5a5IW4KJByNbItD2PmukeFu3hq6vRK9xjulTaQiz68Iq1arnQXG5eWdYkriE+ixkBx+kFTtMoag3Qz9JRNlmxoFWG4HP38aSPlXEdz30ZmBhyjfJ7FsIPGaCFp66e2meKuMP4oPQkIrnlX5dca6kvM5xdVO4jU14q5sQxZgaa8r8Z1gXhJbka6F1gVlOKMn3w9ISTNWYUTuVnBtV5mXefQFm5etjYu57ovNh3jVPRv0QqP2Vba0cZxn2IkOQc0HBSNB5tRbIMFJNSugKi4lBA2hwNTge4DNAMHppEhi6s2Gin/p4Es5BK3JiwtzggPgs+2J0Xc1GLXKlr3QHrczeC3Ubvfx9O6iEpWCdzzjqVAzywJ5w="
    - os: linux
      env:
        - PYTHON_VERSION="3.8"
        - TRAVIS_BASH_VERSION="4.1" TRAVIS_ZSH_VERSION="5.0.0" TRAVIS_FISH_VERSION="2.2.0" TRAVIS_GIT_VERSION="1.8.5"
        - secure: "QhVCwaBpCebV4ZEgvqrymqTboawuGF6+VrbA6hytxP6j6cN6gGKYZt0CLcemUylGQFD4wnKtVHnB0CH9XEQdCORroRXsl1ovpGYvOkM0jGRXZ/veS//kKfuF+BE6o0Mk7O0XseQjDeAAwjC336luxpjEjSf/oIMa3p9NBvjQe+Tsqzal2jYrWsAOG8DkO2hVzXU2VeuxnANt7oxfn8kHsRJsxLREZV+0SEsQXoHv14s6Id2ZkyK2NKCzhLKfzkU/oD0hZvuaKLDMdVCa7V6/xNhcCvtKC/V63M8OxJ/q5JZj7+XUjSBui0/Nsmy5a5IW4KJByNbItD2PmukeFu3hq6vRK9xjulTaQiz68Iq1arnQXG5eWdYkriE+ixkBx+kFTtMoag3Qz9JRNlmxoFWG4HP38aSPlXEdz30ZmBhyjfJ7FsIPGaCFp66e2meKuMP4oPQkIrnlX5dca6kvM5xdVO4jU14q5sQxZgaa8r8Z1gXhJbka6F1gVlOKMn3w9ISTNWYUTuVnBtV5mXefQFm5etjYu57ovNh3jVPRv0QqP2Vba0cZxn2IkOQc0HBSNB5tRbIMFJNSugKi4lBA2hwNTge4DNAMHppEhi6s2Gin/p4Es5BK3JiwtzggPgs+2J0Xc1GLXKlr3QHrczeC3Ubvfx9O6iEpWCdzzjqVAzywJ5w="
    - os: osx
      env:
        - PYTHON_VERSION="3.5"
        - TRAVIS_BASH_VERSION="4.1" TRAVIS_ZSH_VERSION="5.0.0" TRAVIS_FISH_VERSION="2.2.0" TRAVIS_GIT_VERSION="1.8.5"
        - secure: "QhVCwaBpCebV4ZEgvqrymqTboawuGF6+VrbA6hytxP6j6cN6gGKYZt0CLcemUylGQFD4wnKtVHnB0CH9XEQdCORroRXsl1ovpGYvOkM0jGRXZ/veS//kKfuF+BE6o0Mk7O0XseQjDeAAwjC336luxpjEjSf/oIMa3p9NBvjQe+Tsqzal2jYrWsAOG8DkO2hVzXU2VeuxnANt7oxfn8kHsRJsxLREZV+0SEsQXoHv14s6Id2ZkyK2NKCzhLKfzkU/oD0hZvuaKLDMdVCa7V6/xNhcCvtKC/V63M8OxJ/q5JZj7+XUjSBui0/Nsmy5a5IW4KJByNbItD2PmukeFu3hq6vRK9xjulTaQiz68Iq1arnQXG5eWdYkriE+ixkBx+kFTtMoag3Qz9JRNlmxoFWG4HP38aSPlXEdz30ZmBhyjfJ7FsIPGaCFp66e2meKuMP4oPQkIrnlX5dca6kvM5xdVO4jU14q5sQxZgaa8r8Z1gXhJbka6F1gVlOKMn3w9ISTNWYUTuVnBtV5mXefQFm5etjYu57ovNh3jVPRv0QqP2Vba0cZxn2IkOQc0HBSNB5tRbIMFJNSugKi4lBA2hwNTge4DNAMHppEhi6s2Gin/p4Es5BK3JiwtzggPgs+2J0Xc1GLXKlr3QHrczeC3Ubvfx9O6iEpWCdzzjqVAzywJ5w="
    - os: osx
      env:
        - PYTHON_VERSION="3.6"
        - TRAVIS_BASH_VERSION="4.1" TRAVIS_ZSH_VERSION="5.0.0" TRAVIS_FISH_VERSION="2.2.0" TRAVIS_GIT_VERSION="1.8.5"
        - secure: "QhVCwaBpCebV4ZEgvqrymqTboawuGF6+VrbA6hytxP6j6cN6gGKYZt0CLcemUylGQFD4wnKtVHnB0CH9XEQdCORroRXsl1ovpGYvOkM0jGRXZ/veS//kKfuF+BE6o0Mk7O0XseQjDeAAwjC336luxpjEjSf/oIMa3p9NBvjQe+Tsqzal2jYrWsAOG8DkO2hVzXU2VeuxnANt7oxfn8kHsRJsxLREZV+0SEsQXoHv14s6Id2ZkyK2NKCzhLKfzkU/oD0hZvuaKLDMdVCa7V6/xNhcCvtKC/V63M8OxJ/q5JZj7+XUjSBui0/Nsmy5a5IW4KJByNbItD2PmukeFu3hq6vRK9xjulTaQiz68Iq1arnQXG5eWdYkriE+ixkBx+kFTtMoag3Qz9JRNlmxoFWG4HP38aSPlXEdz30ZmBhyjfJ7FsIPGaCFp66e2meKuMP4oPQkIrnlX5dca6kvM5xdVO4jU14q5sQxZgaa8r8Z1gXhJbka6F1gVlOKMn3w9ISTNWYUTuVnBtV5mXefQFm5etjYu57ovNh3jVPRv0QqP2Vba0cZxn2IkOQc0HBSNB5tRbIMFJNSugKi4lBA2hwNTge4DNAMHppEhi6s2Gin/p4Es5BK3JiwtzggPgs+2J0Xc1GLXKlr3QHrczeC3Ubvfx9O6iEpWCdzzjqVAzywJ5w="
    - os: osx
      env:
        - PYTHON_VERSION="3.7"
        - TRAVIS_BASH_VERSION="4.1" TRAVIS_ZSH_VERSION="5.0.0" TRAVIS_FISH_VERSION="2.2.0" TRAVIS_GIT_VERSION="1.8.5"
        - secure: "QhVCwaBpCebV4ZEgvqrymqTboawuGF6+VrbA6hytxP6j6cN6gGKYZt0CLcemUylGQFD4wnKtVHnB0CH9XEQdCORroRXsl1ovpGYvOkM0jGRXZ/veS//kKfuF+BE6o0Mk7O0XseQjDeAAwjC336luxpjEjSf/oIMa3p9NBvjQe+Tsqzal2jYrWsAOG8DkO2hVzXU2VeuxnANt7oxfn8kHsRJsxLREZV+0SEsQXoHv14s6Id2ZkyK2NKCzhLKfzkU/oD0hZvuaKLDMdVCa7V6/xNhcCvtKC/V63M8OxJ/q5JZj7+XUjSBui0/Nsmy5a5IW4KJByNbItD2PmukeFu3hq6vRK9xjulTaQiz68Iq1arnQXG5eWdYkriE+ixkBx+kFTtMoag3Qz9JRNlmxoFWG4HP38aSPlXEdz30ZmBhyjfJ7FsIPGaCFp66e2meKuMP4oPQkIrnlX5dca6kvM5xdVO4jU14q5sQxZgaa8r8Z1gXhJbka6F1gVlOKMn3w9ISTNWYUTuVnBtV5mXefQFm5etjYu57ovNh3jVPRv0QqP2Vba0cZxn2IkOQc0HBSNB5tRbIMFJNSugKi4lBA2hwNTge4DNAMHppEhi6s2Gin/p4Es5BK3JiwtzggPgs+2J0Xc1GLXKlr3QHrczeC3Ubvfx9O6iEpWCdzzjqVAzywJ5w="
    - os: osx
      env:
        - PYTHON_VERSION="3.8"
        - TRAVIS_BASH_VERSION="4.1" TRAVIS_ZSH_VERSION="5.0.0" TRAVIS_FISH_VERSION="2.2.0" TRAVIS_GIT_VERSION="1.8.5"
        - secure: "QhVCwaBpCebV4ZEgvqrymqTboawuGF6+VrbA6hytxP6j6cN6gGKYZt0CLcemUylGQFD4wnKtVHnB0CH9XEQdCORroRXsl1ovpGYvOkM0jGRXZ/veS//kKfuF+BE6o0Mk7O0XseQjDeAAwjC336luxpjEjSf/oIMa3p9NBvjQe+Tsqzal2jYrWsAOG8DkO2hVzXU2VeuxnANt7oxfn8kHsRJsxLREZV+0SEsQXoHv14s6Id2ZkyK2NKCzhLKfzkU/oD0hZvuaKLDMdVCa7V6/xNhcCvtKC/V63M8OxJ/q5JZj7+XUjSBui0/Nsmy5a5IW4KJByNbItD2PmukeFu3hq6vRK9xjulTaQiz68Iq1arnQXG5eWdYkriE+ixkBx+kFTtMoag3Qz9JRNlmxoFWG4HP38aSPlXEdz30ZmBhyjfJ7FsIPGaCFp66e2meKuMP4oPQkIrnlX5dca6kvM5xdVO4jU14q5sQxZgaa8r8Z1gXhJbka6F1gVlOKMn3w9ISTNWYUTuVnBtV5mXefQFm5etjYu57ovNh3jVPRv0QqP2Vba0cZxn2IkOQc0HBSNB5tRbIMFJNSugKi4lBA2hwNTge4DNAMHppEhi6s2Gin/p4Es5BK3JiwtzggPgs+2J0Xc1GLXKlr3QHrczeC3Ubvfx9O6iEpWCdzzjqVAzywJ5w="

before_install:
  - make install-conda
  - PYTHON_VERSION=$PYTHON_VERSION make init-env-conda
  - if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then ./ci/test-utils/installs/install-linux-deps.sh; fi;
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then ./ci/test-utils/installs/install-osx-deps.sh; fi;

install:
  - make install
  # the conda wrappers will make sure pearl executable can be run without activating the conda environment
  - make create-conda-wrappers
  - PATH=${HOME}/miniconda3/envs/pearl/bin/wrappers/:$PATH

script:
  - git --version
  - bash --version
  - zsh --version
  - fish --version
  - make lint
  - make test
  - pearl --help
  - bash ./ci/integ-tests.sh $PWD
  - zsh ./ci/integ-tests.sh $PWD
  - fish ./ci/integ-tests.fish $PWD

after_success:
  - ./ci/deploy.sh
